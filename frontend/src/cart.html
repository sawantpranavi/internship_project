<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iManage | Home</title>
    <link rel="stylesheet" href="../src/css/styles.css">
    <link rel="stylesheet" href="../src/css/amc.css">
    <link rel="stylesheet" href="../src/css/cart.css">
</head>
<body>
    <div class="container">
        <h1>Welcome to iManage</h1>
        <br>
        <div>
            <ul class="menu">
                <li>
                    <a href="#">Categories</a>
                    <ul class="dropdown">
                        <li><a href="categories/computer/comp.html">Computers and Laptops - A</a></li>
                        <li><a href="categories/printer/printers.html">Printers - B</a></li>
                        <li><a href="categories/scanner/scanners.html">Scanners - C</a></li>
                        <li><a href="categories/plotters/plotters.html">Plotters - D</a></li>
                        <li><a href="categories/ups/ups.html">UPS Online Offline - E</a></li>
                        <li><a href="categories/xerox/xerox.html">Photocopiers, Xerox Machines - F</a></li>
                        <li><a href="categories/mobilitydevices/mobility.html">Mobility Devices - G</a></li>
                        <li><a href="categories/videodevices/videounits.html">Video Conferencing Devices - H</a></li>
                        <li><a href="categories/displayunits/displayunits.html">Display Units - I</a></li>
                        <li><a href="categories/miscellaneous/miscellaneous.html">Miscellaneous - J</a></li>
                        <li><a href="categories/biometric/biometrics.html">Biometrics Attendance Device - K</a></li>
                        <li><a href="categories/antivirus/antivirus.html">Anti Virus - L</a></li>
                    </ul>
                </li>
                <li><a href="#">Explore Shop</a></li>
                <li>
                    <a href="#">Services</a>
                    <ul class="dropdown">
                        <li><a href="#">New Procurement</a></li>
                        <li><a href="#">AMC Request</a></li>
                        <li><a href="#">View Tickets</a></li>
                    </ul>
                </li>
                <li><a href="contactus/contact.html">Contact Us</a></li>
            </ul>
        </div>

        <div class="cart">            
            <p id="mycart">MY CART</p>            
                <table border="2">
                    <tr>
                        <th><input type="checkbox" id="checkAll"></th>
                        <th>NAME</th>
                        <th>VENDOR NAME</th>
                        <th>UNIT PRICE</th>
                        <th>QUANTITY</th>
                        <th>TOTAL</th>
                        <th><i class="delete-icon" onclick="confirmDelete()">&#128465;</i></th>
                    </tr>
                    <!-- Cart items will be populated here dynamically -->
                </table>
                
                <br>
                <div class="location-section">
                    <input type="checkbox" id="addLocations" onclick="toggleLocations()">
                    <label for="addLocations">Add multiple locations</label>
                    
                    <div id="locationTable">
                        <div class="location-row">
                            <label for="delivery_address_1">Delivery Address</label>
                            <input type="text" id="delivery_address_1" name="delivery_address[]" placeholder="Full Address" required>
                            <input type="number" id="quantity_1" name="quantity[]" placeholder="Quantity" required>
                            <button type="button" class="add-btn" onclick="addRow()">+</button>
                        </div>
                    </div>
                </div>
        </div>

        <div class="row_cart">
            <div class="form-group_cart">
                <label for="dname">Department name</label>
                <input type="text" id="dname" name="dname" placeholder="Department name" required>
            </div>
            <div class="form-group_cart">
                <label for="daddress">Department address</label>
                <input type="text" id="daddress" name="daddress" placeholder="Department address" required>
            </div>
            <div class="form-group_cart">
                <label for="dept_contact">Department Contact No.</label>
                <input type="text" id="dept_contact" name="dept_contact" placeholder="Department Contact No." required>
            </div>
        </div>

        <div class="row_cart1">
            <div class="form-group_cart1">
                <label for="hod_name">HOD Name</label>
                <input type="text" id="hod_name" name="hod_name" placeholder="HOD Name" required>
            </div>
            <div class="form-group_cart1">
                <label for="district">District</label>
                <input type="text" id="district" name="district" placeholder="District" required>
            </div>
            <div class="form-group_cart1">
                <label for="taluka">Taluka</label>
                <input type="text" id="taluka" name="taluka" placeholder="Taluka" required>
            </div>
        </div>

        <div class="row_cart2">
            <div class="form-group_cart2">
                <label for="constituency">Constituency</label>
                <input type="text" id="constituency" name="constituency" placeholder="constituency" required>
            </div>
            <div class="form-group_cart2">
                <label for="user_address">User Address</label>
                <input type="text" id="user_address" name="user_address" placeholder="User Address" required>
            </div>
            <div class="form-group_cart2">
                <label for="remarks">Remarks</label>
                <input type="text" id="remark" name="remark" placeholder="Remark">
            </div>
        </div>

        <button class="confirm-order">CONFIRM ORDER</button><br>
        <button class="CONTINUE">CONTINUE SHOPPING</button><br>

        <script>
            async function loadCartItems() {
                try {
                    const response = await fetch('http://localhost:3000/api/imanage/cart', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include' // Sends the cookies with the request
                    });

                    if (response.ok) {
                        const cartItems = await response.json(); // Assuming the response is JSON

                        populateCartTable(cartItems);
                    } else {
                        console.error('Failed to load cart items:', response.statusText);
                    }
                } catch (error) {
                    console.error('Error while fetching cart items:', error);
                }
            }

            function populateCartTable(cartItems) {
                const cartTable = document.querySelector('.cart table');

                cartItems.forEach(item => {
                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td><input type="checkbox"></td>
                        <td>${item.name}</td>
                        <td>${item.vendorName}</td>
                        <td>${item.unitPrice}</td>
                        <td>${item.quantity}</td>
                        <td>${item.unitPrice * item.quantity}</td>
                        <td><i class="delete-icon" onclick="confirmDelete(${item.id})">&#128465;</i></td>
                    `;

                    cartTable.appendChild(row);
                });
            }

            function toggleLocations() {
                var checkbox = document.getElementById("addLocations");
                var locationTable = document.getElementById("locationTable");
                
                if (checkbox.checked) {
                    addRow();  // Add the first row when checkbox is checked
                } else {
                    // Clear additional rows
                    locationTable.innerHTML = `
                        <div class="location-row">
                            <label for="delivery_address_1">Delivery Address</label>
                            <input type="text" id="delivery_address_1" name="delivery_address[]" placeholder="Full Address" required>
                            <input type="number" id="quantity_1" name="quantity[]" placeholder="Quantity" required>
                            <button type="button" class="add-btn" onclick="addRow()">+</button>
                        </div>
                    `;
                }
            }

            function addRow() {
                var locationTable = document.getElementById("locationTable");
                var rowCount = locationTable.getElementsByClassName("location-row").length;
                var newRowNumber = rowCount + 1;

                var newRow = document.createElement("div");
                newRow.className = "location-row";
                newRow.innerHTML = `
                    <label for="delivery_address_${newRowNumber}">Delivery Address</label>
                    <input type="text" id="delivery_address_${newRowNumber}" name="delivery_address[]" placeholder="Full Address" required>
                    <input type="number" id="quantity_${newRowNumber}" name="quantity[]" placeholder="Quantity" required>
                    <button type="button" class="remove-btn" onclick="removeRow(this)">X</button>
                `;
                locationTable.appendChild(newRow);
            }

            function removeRow(button) {
                var row = button.parentElement;
                row.parentElement.removeChild(row);
            }

            document.addEventListener('DOMContentLoaded', () => {
                loadCartItems();
            });
        </script>
    </div>
</body>
</html>
